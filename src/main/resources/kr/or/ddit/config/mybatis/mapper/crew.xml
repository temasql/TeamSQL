<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="crew">

	<!-- Insert -->
	<insert id="insertCrew" parameterType="crewVo">
		INSERT INTO CREW
		VALUES (#{account_id_fk}, #{user_id_fk})
	</insert>
	
	<!-- SelectOne -->
	<select id="get" parameterType="String" resultType="crewVo">
		SELECT *
		FROM CREW
		WHERE ID = #{id}
	</select>
	
	<!-- SelectList -->
	<select id="crewList" parameterType="map" resultType="crewVo">
		<![CDATA[ 
			SELECT *
			FROM 
				(SELECT A.*, ROWNUM RN 
				FROM 
					(SELECT ACCOUNT_ID_FK, USER_ID_FK, USER_NAME, USER_EMAIL, USER_PATH 
					FROM  CREW A, USERS
                    WHERE USER_ID_FK = USER_ID
                    AND USER_ID_FK = #{user_id}
                    AND ACCOUNT_ID_FK = #{account_id_fk, jdbcType=VARCHAR}
                    AND USER_ID_FK LIKE '%'||#{search}||'%'
					ORDER BY USER_ID_FK) A) 
			WHERE RN >= (#{page} - 1) * #{pageSize} + 1 
			AND   RN <=  #{page} * #{pageSize} 
		]]>
	</select>
	
	<select id="crewSearchCount" parameterType="map" resultType="int">
		SELECT COUNT(USER_ID_FK)
	    FROM CREW
	    WHERE ACCOUNT_ID_FK = #{account_id_fk}
	    AND USER_ID_FK LIKE '%'||#{search}||'%'
	</select>
	
	<select id="map" parameterType="map" resultType="crewVo">
		SELECT *
		FROM CREW
		WHERE ID = #{map1}
		AND .. = #{map2}
		...
	</select>
	
	<!-- update -->
	<update id="update" parameterType="crewVo">
		UPDATE CREW
		SET COLUMN = #{..}
		WHERE ID = #{id}
	</update>
	
	<!-- delete -->
	<delete id="deleteCrew" parameterType="crewVo">
		DELETE
		FROM CREW
		WHERE ACCOUNT_ID_FK = #{account_id_fk}
		AND USER_ID_FK = #{user_id_fk}
	</delete>

	<select id="crewSelectList" parameterType="string" resultType="crewVo">
		select *
		from crew
		where user_id_fk = #{user_id}
	</select>

</mapper>